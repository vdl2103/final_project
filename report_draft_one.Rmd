---
title: "Report - first draft"
output: github_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### REPORT- FIRST DRAFT 

#### motivation + related 
```{r}
# Tory 
```

#### Project Questions

Initially, our project aimed to answer the following question:

* What is the association between weather and the speed and type of baseball pitches? We hypothesized that the speed and type of Major League Baseball (MLB) pitches may be negatively impacted by extreme weather.  

To operationalize this, we focused on the following weather data: maximum temperature, relative humidity, and heat index. We then focused in on fastball pitches in particular, hypothesizing that these pitches may be most affected by temperature, humidity, and heat index.  

As our research progressed, and it became clear that overall trends relating max temperature and pitch speed were not apparent, we began investigating if a potential relationship between pitch speed and weather could be modified by if a team *typically* played in an extreme weather condition. In other words, were teams that played the majority of their games in cooler climates, i.e. the Milwaukee Brewers, more affected by heat when they played in hotter climates, for example at the Texas Rangers stadium? This led to a revised question:

* Revised question here.

```{r}
# All of us - take from project proposal 

```

#### data
```{r}
#Stephen + Brennan 

```

## Weather data

### PRISM climate model  

We obtained our weather data from the Parameter-elevation Regressions on Independent Slopes Model (PRISM) Daily Spatial Climate Dataset (AN81d) developed by the PRISM Climate Group based at Oregon State University. This is a gridded climate model that assimilates station data from networks around the United States and applies interpolation routines to simulate variations with elevation, coastal effects, temperature inversions, and terrain barriers. The model includes 7 bands of output parameters at a 2.5 arc minute grid resolution (https://developers.google.com/earth-engine/datasets/catalog/OREGONSTATE_PRISM_AN81d).

### Google Earth Engine  

Using the code editor in the Google Earth Engine platform (https://code.earthengine.google.com), we extracted maximum daily temperature (`tmax`), minimum daily temperature (`tmin`), and mean daily dew point temperature (`tdmean`) from April 2015 through October 2018 at each MLB stadium location. We obtained the latitude and longitude coordinates for each ballpark from a Google Fusion Table (https://fusiontables.google.com/DataSource?docid=1EXApOoxEgJUFlbMjUodfxBSWlRvgQNpABeddHqiN#rows:id=1), which we imported to Earth Engine. We used JavaScript code to create arrays that collect each weather parameter mapped over each ballpark location for each day, reduced to the first observation reflecting the grid at the point of interest, which are then flattened to two dimensional tables.    

<img src = "./gee_screen_capture.PNG" height = "500px" width = "400px" />

Figure XX. The image above is a screenshot of the Earth Engine code editor. The map displays maximum daily temperatures across the United States on July 05, 2018 from the PRISM model.

The JavaScript code for downloading PRISM data is provided at (gee.html). A registered Google account is required to access the code editor. 

### Tidy weather data  

Next, we imported the PRISM files for `tmax`, `tmin`, and `tdmean` into R, tidied the data from "wide" format to "long" format, and joined each parameter to a single dataframe by team and date. We created daily heat index values (`heat_index`) from mean daily air temperature and mean daily dew point temperature using the `heat.index` function of the `weathermetrics` package, which applies a heat index equation derived from the US National Weather Service's online heat index calculator. We also used the `dewpoint.to.humidity` function to obtain relative humidity (`rh`).   

### Reproducability  

The raw data files from Earth Engine and the stadium index from Fusion Table are available at the links below:  

"tdmean_ballpark.PRISM.csv": https://drive.google.com/open?id=11Wptk3Eaul1rJEmXB2Xb9T7G_B82i3MK  
"tmin_ballpark.PRISM.csv"  : https://drive.google.com/open?id=1gtjdciCF4zJmrcyjXnUrj-JNDs437MCa  
"tmax_ballpark.PRISM.csv"  : https://drive.google.com/open?id=1AYqLA1Qp3tOOG7hltIN9-aXuYUkF3SSq  
"stadium_index.csv"        : https://drive.google.com/open?id=13mteZpqRSzkeUObmaL6VwYT9s3QNlDOo  

The joined and cleaned weather dataframe is available at:

"weather.csv" : https://drive.google.com/open?id=1jr1_sSAzSn8SVKralTHWGdQWH0BEX08W










#### Exploratory Analysis 

As outlined in our 11/07/2018 project proposal, based on previous reports and anecdotal evidence, we hypothesized that weather would impact pitch speeds. Specifically, we hypothesized that high temperatures/humidity would be negatively associated with pitch speeds. Therefor, our weather variables of interest were: **temperature (max or mean?), relative humidity, and heat index.** 

We planned to produce the following:  

* Linear model for the effect of temperature on pitch speed (fastball), adjusted for pitcher and other covariates to be determined.

* Graph of variation in proportion of fastball vs off-speed pitches and temperature

* Graph of speed of fastballs and temperature

* Graph of pitch speed (all pitch types) and humidity

* Graph of pitch speed (all pitch types) and heat index

We first conducted exploratory analyses looking at the **heat index (ÂºC).**

For people working outdoors in hot weather, both air temperature and humidity affect how hot they feel. The "heat index" is a single value that takes both temperature and humidity into account. The higher the heat index, the hotter the weather feels, since sweat does not readily evaporate and cool the skin. The heat index is a better measure than air temperature alone for estimating the risk to workers from environmental heat sources. Thus, we also assumed that high heat index would negatively affect pitchers' performance. 

In the exploratory analysis, we first examined missing data. While the Cubs were missing the most heat index data, the distribution of missing heat index data was fairly evenly distributed across all teams.

**note that I'm going to put this code in here for now (basically just combining everything from my EDA doc) and we can edit out later** 

We next explored the distribution of the heat index. 

```{r eda}
# Nicole's EDA

# Examining missing data
complete_db %>% 
  group_by(team_name) %>% 
  filter(is.na(heat_index)) %>% # we are missing pitch speed for 62,971 pitches 
  count() %>% 
  ungroup()# see if the missing data are (roughly) evenly distributed among the teams, Cubs are missing the most but it still seems pretty even 








# Jenni's EDA 



```

#### additional anlaysis: plots
```{r}
#Jenni + Nicole 
```

#### additional analysis: models
```{r}
#Stephen
```

#### discussion
```{r}
#All of us
```

